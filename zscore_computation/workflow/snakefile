configfile: "./workflow/config.yaml"

# get the resolutions and the chromosomes
RESOLUTIONS = config['resolutions']
CHROMOSOMES = config.get("chromosome", "all")

PARENT_FOLDER = config["parent_folder"]
OUTPUT_FOLDER = config["output_folder"]

def yellow(text):
    return "\033[1;33m" + text + "\033[1;m"


def green(text):
    return "\033[1;32m" + text + "\033[1;m"

rule compute_zscore:
    params:
        cores = 10
    run:
        for resolution in RESOLUTIONS:
            chromosomes = []
            if CHROMOSOMES == "all":
                chromosomes = os.listdir(PARENT_FOLDER + resolution)
                chromosomes = [x.replace(".txt", "") for x in chromosomes if x.startswith("chr")]
            
            for chromosome in chromosomes:
                print("Started Computing Z-score for " + yellow(chromosome) + " at resolution " + yellow(resolution))
                input_file = PARENT_FOLDER + "/" + resolution + "/" + chromosome + ".txt"
                output_file = OUTPUT_FOLDER + "/" + resolution + "/" + chromosome + ".txt"

                # Make the output folder if it doesn't exist
                if not os.path.exists(os.path.dirname(output_file)):
                    os.makedirs(os.path.dirname(output_file))
                
                shell("Rscript compute_zscore.R " + input_file + " {params.cores} " + output_file)
                print("Finished Computing Z-score for " + yellow(chromosome) + " at resolution " + yellow(resolution))